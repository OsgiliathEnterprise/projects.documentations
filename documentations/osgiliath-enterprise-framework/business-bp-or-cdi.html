<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Blueprint or CDI - Osgiliath Enterprise</title>
  <meta name="author" content="Charlie Mordant">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html">
  <link href="/projects.documentations/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Osgiliath Enterprise" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html">
  <meta property="og:title" content="Blueprint or CDI - Osgiliath Enterprise">
  

  <script src="/projects.documentations/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/projects.documentations/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/projects.documentations/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/projects.documentations/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-52173804-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/projects.documentations/">Osgiliath Enterprise</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li >
                    <a rel="index" href="/projects.documentations/">Blog</a>
                </li>
                <li >
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Products<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="/projects.documentations/products/osgiliath-enterprise-framework">Osgiliath Framework</a>
                        </li>
                    </ul>
                </li>
                <li >
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentations<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="/projects.documentations/documentations/osgiliath-enterprise-framework">Osgiliath Framework</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/projects.documentations/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:osgiliathEnterprise.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article role="article">
      
        <header class="page-header">
          
            <p class="meta text-muted text-uppercase">












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-22T18:44:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time></p>
          
          
            <h1 class="entry-title">
              Blueprint or CDI
              
            </h1>
          
        </header>
      
      <div class="entry-content">
        <article>
Both business and routes archetypes are declined in two versions: a blueprint one and an xml one.

These both frameworks have the goal to wire your beans together, but not the same way.

Note that the both framework can NOT reference other beans produced by the other framework in the same bundle (e.g. you can&#8217;t reference a cdi bean in blueprint and vice versa).
<article>
<header>
<H1 id="blueprint">Blueprint</H1>
</header>
Blueprint is the most known and stable bean wiring OSGI framework.
It&#8217;s purpose is to wire beans together with the help of an xml descriptor located in src/main/resources/OSGI-INF/blueprint/[file].xml

For example, if you want to inject a validator on one service like this:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServiceJaxRS</span> <span class="kd">implements</span> <span class="n">net</span><span class="o">.</span><span class="na">osgiliath</span><span class="o">.</span><span class="na">hello</span><span class="o">.</span><span class="na">business</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">HelloServiceJaxRS</span> <span class="o">{</span>
</span><span class='line'>	<span class="nd">@Setter</span>
</span><span class='line'>	<span class="kd">private</span> <span class="n">HelloObjectRepository</span> <span class="n">helloObjectRepository</span><span class="o">;...</span>
</span></code></pre></td></tr></table></div></figure>
You will have a counterpart in the xml file:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;helloServiceJaxRs&quot;</span>
</span><span class='line'>		<span class="na">class=</span><span class="s">&quot;net.osgiliath.hello.business.impl.services.impl.HelloServiceJaxRS&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;helloObjectRepository&quot;</span> <span class="na">ref=</span><span class="s">&quot;helloObjectRepository&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span><span class='line'>	<span class="nt">&lt;/bean&gt;</span>
</span></code></pre></td></tr></table></div></figure>

With blueprint, you can also reference properties (compendium), some custom namespaces (for example aries-jpa, aries-tx) or OSGI service.

<h2>Traps</h2>
All external classes referenced in a bp.xml file are not scanned by the bundle plugin so they&#8217;re package-import are not added to the MANIFEST of your bundle, you&#8217;ll have to add them manually in the osgi.bnd file
</article>
<article>
<header>
<H1 id="cdi">CDI</H1>
</header>
CDI wires beans via annotations on classes, fields&#8230;
As the code is concise and do not repeat (no need for xml), it can add burden on your java classes, making them less readable.

In order to enable a certain kind of annotations for your bundles, you&#8217;ve to add a Require-Capability header on your osgi.bnd file

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>Require-Capability: osgi.extender;filter:=&quot;(osgi.extender=pax.cdi)&quot;,\ <span class="c">&lt;!-- Declaration to enable CDI on your project (you&#39;ll also need a bean.xml file)--&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=pax-cdi-extension)&quot;,\ <span class="c">&lt;!-- allow export and reference OSGI services with annotations --&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=validation)&quot;,\ <span class="c">&lt;!-- Enables JSR 303 (validation) annotations scanning --&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=cxf-integration-cdi)&quot;,\ <span class="c">&lt;!-- Enables REST services declarations via annotations --&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=deltaspike-core-api)&quot;,\ <span class="c">&lt;!-- DS is a nice angular stone for CDI --&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=camel-cdi-extension)&quot;,\ <span class="c">&lt;!-- JMS annotations scanning --&gt;</span>
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=eager)&quot; <span class="c">&lt;!-- Enables Eager beans annotations, they&#39;ll start when bundle state will be &#39;Active&#39; --&gt;</span>
</span></code></pre></td></tr></table></div></figure>

In addition, you must have at least a beans.xml file located on src/main/resources/META-INF: this file can also refer to alternatives beans (for example while testing), or interceptors (something that wraps your methods adding some behaviour to it).

<H2>Traps</H2>
<ul>
<li>Config admin properties that are referenced via annotations are not updated while changing, also you can tell from which persistent id the property come from: beware to not publish the same property twice.</li>
<li>@Consume camel annotation cannot be used with CDI, you have to make a route to handle messages (extends routebuilder).</li>
<li>@ContextName camel annotation can only reference a &#8216;general&#8217; camel context, you can&#8217;t have many for a platform</li>
<li>Jpa archetype cannot be CDI-driven as (for the time writing) only aries-jpa can handle persistence.</li>
</ul>
</article>
</article>
      </div>
      
        <footer>
          <p class="meta text-muted">
            
            












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-22T18:44:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
            
          </p>
          
            <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html" data-via="Tcharl" data-counturl="http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="small"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

          
        </footer>
      
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/projects.documentations/blog/2014/06/22/changelogs/">Changelogs</a>
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating&#8230;</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/OsgiliathEnterprise">@OsgiliathEnterprise</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'OsgiliathEnterprise',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/projects.documentations/javascripts/github.js" type="text/javascript"> </script>
</section>




<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h2>
      <a href="https://plus.google.com/+CharlieMordant?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h2>
  </div>
</section>



      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2015 - Charlie Mordant<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'osgiliathenterprise';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html';
        var disqus_url = 'http://osgiliathEnterprise.github.io/documentations/osgiliath-enterprise-framework/business-bp-or-cdi.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/projects.documentations/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/projects.documentations/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
