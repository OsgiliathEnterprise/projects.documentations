
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Blueprint or CDI - Osgiliath Enterprise framework</title>
  <meta name="author" content="Charlie Mordant">

  
  <meta name="description" content="Blueprint or CDI Both business and routes archetypes are declined in two versions: a blueprint one and an xml one. These both frameworks have the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://OsgiliathEnterprise.github.io/documentation/business-bp-or-cdi.html">
  <link href="/projects.documentations/favicon.png" rel="icon">
  <link href="/projects.documentations/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Osgiliath Enterprise framework" type="application/atom+xml">
  <script src="/projects.documentations/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/projects.documentations/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52173804-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Blueprint or CDI</h1>
        <article>
Both business and routes archetypes are declined in two versions: a blueprint one and an xml one.

These both frameworks have the goal to wire your beans together, but not the same way.

Note that the both framework can NOT reference other beans produced by the other framework in the same bundle (e.g. you can&#8217;t reference a cdi bean in blueprint and vice versa).
<article>
<header>
<H1>Blueprint</H1>
</header>
Blueprint is the most known and stable bean wiring OSGI framework.
It&#8217;s purpose is to wire beans together with the help of an xml descriptor located in src/main/resources/OSGI-INF/blueprint/[file].xml

For example, if you want to inject a validator on one service like this:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServiceJaxRS</span> <span class="kd">implements</span> <span class="n">net</span><span class="o">.</span><span class="na">osgiliath</span><span class="o">.</span><span class="na">hello</span><span class="o">.</span><span class="na">business</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">HelloServiceJaxRS</span> <span class="o">{</span>
</span><span class='line'>	<span class="nd">@Setter</span>
</span><span class='line'>	<span class="kd">private</span> <span class="n">HelloObjectRepository</span> <span class="n">helloObjectRepository</span><span class="o">;...</span>
</span></code></pre></td></tr></table></div></figure>
You will have a counterpart in the xml file:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;helloServiceJaxRs&quot;</span>
</span><span class='line'>		<span class="na">class=</span><span class="s">&quot;net.osgiliath.hello.business.impl.services.impl.HelloServiceJaxRS&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;helloObjectRepository&quot;</span> <span class="na">ref=</span><span class="s">&quot;helloObjectRepository&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span><span class='line'>	<span class="nt">&lt;/bean&gt;</span>
</span></code></pre></td></tr></table></div></figure>

With blueprint, you can also reference properties (compendium), some custom namespaces (for example aries-jpa, aries-tx) or OSGI service.

<h2>Traps</h2>
All external classes referenced in a bp.xml file are not scanned by the bundle plugin so they&#8217;re package-import are not added to the MANIFEST of your bundle, you&#8217;ll have to add them manually in the osgi.bnd file
</article>
<article>
<header>
<H1>CDI</H1>
</header>
CDI wires beans via annotations on classes, fields&#8230;
As the code is concise and do not repeat (no need for xml), it can add burden on your java classes, making them less readable.

In order to enable a certain kind of annotations for your bundles, you&#8217;ve to add a Require-Capability header on your osgi.bnd file

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>Require-Capability: osgi.extender;filter:=&quot;(osgi.extender=pax.cdi)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=pax-cdi-extension)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=validation)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=jaxrs-cdi)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=osgiliath-camel-cdi-extension)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=camel-configadmin-extension)&quot;,\
</span><span class='line'> org.ops4j.pax.cdi.extension;filter:=&quot;(extension=eager)&quot;
</span></code></pre></td></tr></table></div></figure>

In addition, you must have at least a beans.xml file located on src/main/resources/META-INF: this file can also refer to alternatives beans (for example while testing), or interceptors (something that wraps your methods adding some behaviour to it).

<H2>Traps</H2>
<ul>
<li>Config admin properties that are referenced via annotations are not updated while changing, also you can tell from which persistent id the property come from: beware to not publish the same property twice.</li>
<li>@Consume camel annotation cannot be used with CDI, you have to make a route to handle messages.</li>
<li>@ContextName camel annotation can only reference a &#8216;general&#8217; camel context, you can&#8217;t have many for a platform</li>
<li>Jpa archetype cannot be CDI-driven as (for the time writing) only aries-jpa can handle persistence.</li>
</ul>
</article>
</article>
      </div>
    </div>
  </div>
</article>


    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/Tcharl"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/OsgiliathEnterprise"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
      

<script type="text/javascript">
      var disqus_shortname = 'osgiliathenterprise';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://OsgiliathEnterprise.github.io/documentation/business-bp-or-cdi.html';
        var disqus_url = 'http://OsgiliathEnterprise.github.io/documentation/business-bp-or-cdi.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


    
  </body>
</html>
